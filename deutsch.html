<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Deutsch Lernkarte</title>
<style>
  body {
    font-family: 'Comic Sans MS', 'Comic Sans', cursive; /* Artistic font for the streak message */
    font-size: 18px;
  }
  .header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }
  .calendar {
    width: 25%;
    text-align: right;
  }
  table {
    width: 80%;
    margin: 20px auto;
    border-collapse: collapse;
  }
  th, td {
    padding: 8px;
    text-align: center;
  }
  th:first-child, td:first-child {
    width: 20%;
  }
  tr:not(:first-child) {
    border-top: 1px solid #ccc;
  }
  tr:nth-child(even) {
    background-color: #f2f2f2;
  }
  tr:nth-child(odd) {
    background-color: #e7f3fe;
  }
  .checked {
    background-color: #a4d7a5;
  }
  select {
    margin: 20px auto;
    display: block;
  }
  .editable {
    background-color: #fff;
    border: none;
    width: 100%;
    min-width: 100px;
  }
  .streak-message {
    text-align: center;
    margin-top: 20px;
  }
  .highlight {
    font-weight: bold;
    color: #ff4500; /* Highlight color */
  }
  .emoji {
    font-size: 24px;
  }
</style>
</head>
<body>
<div class="header">
  <h2>Deutsch Lernkarte</h2>
  <div id="streakMessage" class="streak-message">
    <!-- Streak message will be inserted here by JavaScript -->
  </div>
  <div class="calendar">
    <table id="calendarTable">
      <!-- Calendar filled by JavaScript -->
    </table>
  </div>
</div>
<select id="yearMonthSelect" onchange="changeMonth(this.value)">
  <!-- Options filled by JavaScript -->
</select>
<table id="daysTable">
  <tr>
    <th>Datum</th>
    <th>Lerninhalt</th>
    <th>Lernzeit</th>
    <th>Status</th>
  </tr>
  <!-- Rows will be added by JavaScript -->
</table>
<script>
window.onload = function() {
  populateYearMonthSelector();
  loadTableForCurrentMonth();
};

function populateYearMonthSelector() {
  const select = document.getElementById('yearMonthSelect');
  const currentYear = new Date().getFullYear();
  for (let year = currentYear - 1; year <= currentYear + 1; year++) {
    for (let month = 1; month <= 12; month++) {
      const option = document.createElement('option');
      const monthPadded = month.toString().padStart(2, '0');
      option.value = `${year}-${monthPadded}`;
      option.textContent = `${year}-${monthPadded}`;
      select.appendChild(option);
      if (new Date().getMonth() + 1 === month && currentYear === year) {
        option.selected = true;
      }
    }
  }
  changeMonth(select.value);
}

function changeMonth(yearMonth) {
  generateDays(yearMonth);
  generateCalendar(yearMonth);
  updateStreakMessage(yearMonth);
}

function generateCalendar(yearMonth) {
  const [year, month] = yearMonth.split('-');
  const firstDay = new Date(year, month - 1, 1).getDay();
  const daysInMonth = new Date(year, month, 0).getDate();
  const calendarTable = document.getElementById('calendarTable');
  calendarTable.innerHTML = '';
  let day = 1;
  for (let i = 0; i < 6; i++) {
    const row = calendarTable.insertRow(-1);
    for (let j = 0; j < 7; j++) {
      const cell = row.insertCell(-1);
      if (i === 0 && j < firstDay || day > daysInMonth) {
        cell.innerHTML = '';
      } else {
        const date = `${year}-${month}-${day.toString().padStart(2, '0')}`;
        cell.innerHTML = day;
        if (localStorage.getItem(date + '-status') === 'true') {
          cell.classList.add('checked');
        }
        day++;
      }
    }
    if (day > daysInMonth) break;
  }
}

function generateDays(yearMonth) {
  const [year, month] = yearMonth.split('-');
  const daysInMonth = new Date(year, month, 0).getDate();
  const table = document.getElementById('daysTable');
  table.innerHTML = '<tr><th>Datum</th><th>Lerninhalt</th><th>Lernzeit</th><th>Status</th></tr>';
  for (let day = 1; day <= daysInMonth; day++) {
    const date = `${year}-${month}-${day.toString().padStart(2, '0')}`;
    const row = table.insertRow(-1);
    const cellDate = row.insertCell(0);
    const cellContent = row.insertCell(1);
    const cellTime = row.insertCell(2);
    const cellStatus = row.insertCell(3);
    cellDate.textContent = date;
    cellContent.contentEditable = true;
    cellContent.classList.add('editable');
    cellContent.textContent = localStorage.getItem(date + '-content') || '';
    cellContent.onblur = function() { localStorage.setItem(date + '-content', this.textContent); };
    cellTime.contentEditable = true;
    cellTime.classList.add('editable');
    cellTime.textContent = localStorage.getItem(date + '-time') || '';
    cellTime.onblur = function() { localStorage.setItem(date + '-time', this.textContent); };
    cellStatus.textContent = localStorage.getItem(date + '-status') === 'true' ? 'Markiert' : 'Klicken zum Markieren';
    cellStatus.classList.toggle('checked', localStorage.getItem(date + '-status') === 'true');
    cellStatus.onclick = function() { toggleCheck(this, date); };
  }
}

function updateStreakMessage(yearMonth) {
  // Streak calculation logic
  const [year, month] = yearMonth.split('-');
  const daysInMonth = new Date(year, month, 0).getDate();
  let streak = 0;
  let missedDays = 0;
  let message = '';
  for (let day = 1; day <= daysInMonth; day++) {
    const date = `${year}-${month}-${day.toString().padStart(2, '0')}`;
    if (localStorage.getItem(date + '-status') === 'true') {
      streak++;
      missedDays = 0; // Reset missed days if a day in the streak is found
    } else {
      missedDays++;
    }
  }
  if (streak > 0) {
    message = `You've achieved a <span class="highlight">${streak}</span> day streak learning German <span class="emoji">ðŸ˜Š</span>`;
  } else {
    message = `You've been lazy for <span class="highlight">${missedDays}</span> day not learning German <span class="emoji">ðŸ˜”</span>`;
  }
  document.getElementById('streakMessage').innerHTML = message;
}

function toggleCheck(cell, date) {
  const isChecked = cell.classList.toggle('checked');
  cell.textContent = isChecked ? 'Markiert' : 'Klicken zum Markieren';
  localStorage.setItem(date + '-status', isChecked);
  changeMonth(document.getElementById('yearMonthSelect').value); // Refresh calendar and streak message

}
</script>
</body>
</html>
