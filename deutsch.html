<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Deutsch Lernkarte</title>
<style>
  table {
    width: 80%;
    margin: 20px auto;
    border-collapse: collapse;
  }
  th, td {
    padding: 8px;
    text-align: center;
  }
  tr:not(:first-child) {
    border-top: 1px solid #ccc;
  }
  .checked {
    background-color: #a4d7a5;
  }
  select {
    margin: 20px auto;
    display: block;
  }
  .editable {
    background-color: #fff;
    border: none;
    width: 100%;
    min-width: 100px; /* Adjust as needed */
  }
</style>
</head>
<body>
<h2>Deutsch Lernkarte</h2>
<select id="yearMonthSelect" onchange="generateDays(this.value)">
  <!-- Options filled by JavaScript -->
</select>
<table id="daysTable">
  <tr>
    <th>Datum</th>
    <th>Lerninhalt</th>
    <th>Lernzeit</th>
    <th>Status</th>
  </tr>
  <!-- Rows will be added by JavaScript -->
</table>
<script>
window.onload = function() {
  populateYearMonthSelector();
  loadTableForCurrentMonth();
};

function populateYearMonthSelector() {
  const select = document.getElementById('yearMonthSelect');
  const currentYear = new Date().getFullYear();
  for (let year = currentYear - 1; year <= currentYear + 1; year++) {
    for (let month = 1; month <= 12; month++) {
      const option = document.createElement('option');
      const monthPadded = month.toString().padStart(2, '0');
      option.value = `${year}-${monthPadded}`;
      option.textContent = `${year}-${monthPadded}`;
      select.appendChild(option);
      if (new Date().getMonth() + 1 === month && currentYear === year) {
        option.selected = true;
      }
    }
  }
}

function loadTableForCurrentMonth() {
  const currentYear = new Date().getFullYear();
  const currentMonth = new Date().getMonth() + 1;
  const currentMonthPadded = currentMonth.toString().padStart(2, '0');
  generateDays(`${currentYear}-${currentMonthPadded}`);
}

function generateDays(yearMonth) {
  const [year, month] = yearMonth.split('-');
  const daysInMonth = new Date(year, month, 0).getDate();
  const table = document.getElementById('daysTable');
  table.innerHTML = '<tr><th>Datum</th><th>Lerninhalt</th><th>Lernzeit</th><th>Status</th></tr>';
  for (let day = 1; day <= daysInMonth; day++) {
    const date = `${year}-${month}-${day.toString().padStart(2, '0')}`;
    const row = table.insertRow(-1);
    const cellDate = row.insertCell(0);
    const cellContent = row.insertCell(1);
    const cellTime = row.insertCell(2);
    const cellStatus = row.insertCell(3);
    cellDate.textContent = date;
    cellContent.contentEditable = true;
    cellContent.classList.add('editable');
    cellContent.textContent = localStorage.getItem(date + '-content') || '';
    cellContent.onblur = function() { localStorage.setItem(date + '-content', this.textContent); };
    cellTime.contentEditable = true;
    cellTime.classList.add('editable');
    cellTime.textContent = localStorage.getItem(date + '-time') || '';
    cellTime.onblur = function() { localStorage.setItem(date + '-time', this.textContent); };
    cellStatus.textContent = localStorage.getItem(date + '-status') === 'true' ? 'Markiert' : 'Klicken zum Markieren';
    cellStatus.classList.toggle('checked', localStorage.getItem(date + '-status') === 'true');
    cellStatus.onclick = function() { toggleCheck(this, date); };
  }
}

function toggleCheck(cell, date) {
  const isChecked = cell.classList.toggle('checked');
  cell.textContent = isChecked ? 'Markiert' : 'Klicken zum Markieren';
  localStorage.setItem(date + '-status', isChecked);
}
</script>
</body>
</html>
